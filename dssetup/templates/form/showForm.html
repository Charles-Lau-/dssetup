{%extends "baseForm.html"%} 
{%block form-content%} 
  
        {%load filters%}
       
          <form action={%url "create_main_form"%} method="post" class="form-horizontal" id="create_form">
              {% csrf_token %}
       
              {{main_part|safe}} 
         
            </div>       
          </form>
     
        </div>
      </div>
    
    </div>
   </div>
   
<!--mapping part--->

{%for domainForm in mapping_part%}
 
 <div class="container-fluid">
    <hr>
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-th"></i> </span>
            domainName: <input type="text" value={{domainForm.domainName}} readOnly=true>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
           </div>
          <div class="widget-content nopadding">
            <table class="table table-bordered table-striped">
              <thead>
                 <tr>
                  <th>Ip</th>
                  <th>Mode</th>
                  <th>Sp</th>
                  
                </tr>
              </thead>
              <tbody>
               {%for mapping in domainForm.mapping%}
             
                <tr class="odd gradeX">
                    {%for value in mapping.values%}
                            <th >{{value}} </th>
                     {%endfor%}
                   
                </tr>
                 {%endfor%}
              </tbody>
            </table>
           
          </div>
        </div>
      </div>
    </div>
 </div>
  
{%endfor%}
    <form action="{%url "change_form_status" %}" method="post" id="hidden_form">
    {%csrf_token%}
       <input type="hidden" id="Id" value={{Id}} name="Id">
       <input type="hidden" id="operation" value="" name="operation">
       <input type="hidden" id="comment" value="" name="comment">
       
    </form> 
{%ifequal role "verifier"%}
<a class="btn btn-info"  href="#" onclick="write_comment(this)" id="verify">Verify</a> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 
<a class="btn btn-info"  href="#"  onclick="write_comment(this)" id="reject">Reject</a>  
{%endifequal%}

{%ifequal role "applicant"%}
<a class="btn btn-info"  href="#"  id="close" onclick="javascript:submit(this);">Close</a> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 
<a class="btn btn-info" id="edit"  href="#" >Edit</a> &nbsp&nbsp
<a class="btn btn-info" id="confirm"   href="#" >Confirm</a>  
{%endifequal%}
 
{%ifequal role "operator"%}
<a class="btn btn-info"  id="operate" href="#"  onclick="write_comment(this)">Operate</a> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 
<a class="btn btn-info" id="reject" href="#"  onclick="write_comment(this)">Reject</a>  
{%endifequal%}

{%ifequal role "checker"%}
<a class="btn btn-info"  id="check"  href="#"  onclick="write_comment(this)">Check</a> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 
<a class="btn btn-info" id="reject" href="#"  onclick="write_comment(this)">Reject</a>  
{%endifequal%}
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 
<a class="btn btn-info" href={%url "show_form_history" Id%}  target="_blank">查看表单历史记录</a>  
{%endblock%}

{%block js%}
{{super.block}}
<script>
    
  function write_comment(obj){
     var comment = prompt("请写操作备注","请填写操作备注（可为空）")
     var comm = document.getElementById("comment")
     comm.setAttribute("value",comment)
     
     if(comment != null && comment !=undefined){
                submit(obj)
                }
   
   }
   
    function submit(element){
             var oper = document.getElementById("operation")
             oper.setAttribute("value",element.id)
       
             var form = document.getElementById("hidden_form")
             form.submit()
   }
   
</script>

<script>
  
           
 var elements =  document.getElementsByClassName("control-label")
 for(var i=0;i<elements.length;i++){
     
          if(elements[i].innerText=="表单状态"){
              var value = elements[i].nextSibling.childNodes[0].value
        
              if(value=="rejected"){
                   document.getElementById("edit").onclick = function (){submit(this)}
                }
              if(value=="checked"){
              
                   document.getElementById("confirm").onclick = function (){submit(this)}
              }
    }
    }
    


    
 
</script>


   
 {%endblock%}
